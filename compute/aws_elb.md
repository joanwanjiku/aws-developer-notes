# Elastic load balancing
- Managed by AWS and it is elastic(scales in and out)
- Provides a health check of it's registered targets, routes traffic to healthy targets.
- Flexible, add/remove resources of your LB without disrupting flow of request.
- Works with other services e.g EC2, ECS, Autoscaling, cloudwatch, VPC and Route53.
- Highbrid load balancing between on-prem and AWS resources.
- Enforce stickiness with cookies
- Expose single point of access(DNS) to your application
- SSL termination

## How it works
- When you enable an AZ for your load balancer, a load balancer node is created in the AZ. If you register targets in an AZ but do not enable the AZ, the registered targets do not receive traffic.
- Configure your LB to accept traffic by specifying one or more listerners
## Application ELB
- Cross-zone load-balancing is enabled by default.
- Operates at the request level, Advanced routing, TLS termination and visibility features targeted at application architectures.
- Application layer 7(HTTP/HTTPS)
- Routing tables to different target groups:-
    - Path in URL
    - Hostname in URL
    - Query strings, headers
    
- ALB fit for container-based applications, has port mapping feature to redirect to a dynamic port in ECS
- Application servers do not see the client's IP, true IP is inserted in headers, X-Forwarded-For, X-Forwarded-Port, X-Forwarded-Proto
- Add listeners to your ALB to route requests on defined ports and protocols using routing rules.
- Evaluates the listener rules in priority order to determine which rule to apply, selects target from target group for rule action.
- Selects a target from the target group for the rule action, using the routing algorithm configured for the target group. The default routing algorithm is round robin. Routing is performed independently for each target group, even when a target is registered with multiple target groups.
- Target groups can be:- ECS Tasks, EC2 instances, Lambda functions, IP addresses(must be private)
- Made for path based routing of application requests.
- Using an ALB as a cloudfront origin
- ALB health checks used for failover routing from route53(active/passive)
- Health checks done at a target group level


- *Steps*
    1. Configure target groups:- load balancing > target groups > create target group > add targets(select the instances you want to add)
    2. Create load balancer:- load balancers > create > select AZ > select SG > Attach target group > register target groups > configure rules for your listener
    3. Add listener rule > + > add condition > 

    - Cloudacademy
    
     

## Network ELB
- Transport layer 4(TCP/TLS)
- Connection level, high performance while maintaining low latencies. When you need TLS offloading at scale, support TLS offloading, support for UDP.
- High request volumes. handle millions of requests while maintaining ulta-low latenancy
- Selects a target from target rule for the default rule using a flow hash algorithm. The algorithm is based on:-
1. The protocol
2. The source IP address and source port.
3. The destination IP address and destination port.
4. The TCP sequence number
- Routes each individual TCP connection to a single target for the life of the connection. The TCP connections from a client have different source ports and sequence numbers, and can be routed to different targets.It attempts to open a TCP connection to the selected target on the port specified in the listener config.
- Has one static IP address per AZ and supports assigning elastic IP, use case:- when need application to be accessible with one IP
- Target groups can be:-
    1. EC2 instances
    2. IP Addresses, must be private IPs
    3. Application load balancer

## Gateway loadbalancer
- Deploy, scale, manage virtual appliances e.g firewalls, intrusion detection and prevention systems, deep packet inspection systems.
- Operates at the network layer.
- 
## Classic Load balancer
for EC2 classic instances
- Uses round robin algorithm for TCP listeners
- Uses the least outstanding requests routing algorithm for http and https listeners

## cross-zone load balancing
- auto enabled for ALB, no charges on inter-AZ data transfer
- disabled for NLB, charges for inter-AZ data transfer

## ELB Stickiness(sticky sessions)
- Allow you to route requests to a target in a target group. Used with servers that maintain state information in order to provide a continuos experience to client;, client must support cookies.
- When an ALB receives a HTTP request, it routes the request to a target and generates a cookie named AWSALB.
- Two types of cookies
    1. Custom cookie:- generated by target, can include attributes required by the app, cookie name must be specified individually for each target.
    2. Applictaion cookie:- generated by ALB, cookie name is AWSALBAPP
    3. Duration based cookie:- generated by ALB, cookie name is AWSALB
- Works for classic load balancers and Application load balancers.

## ELB Monitoring
1. Cloudwatch metrics
2. Access logs
3. Request tracing
4. Cloudtrail logs

### Components of an ELB

1. **Listeners**:- A listener defines how your inbound connections are routed to youy target groups based on ports and protocols set as conditions
2. **Target groups**:- fleet of resources to route traffic to
3. **Rules**:- How traffic will be routed.
4. **Health checks**:-
5. **Internet facing elb**:- nodes of the elb are accessible via the internet and have a public DNS name that can be resolved to its public IP address. Allows ELB to serve incoming requests from the internet before distributing and routing traffice to the target groups.
6. **Internal ELB**:- only has an internal IP address, this means can only serve requests originating from the VPC.
7. **ELB Node**:- For each AZ selected an ELB node will be placed within that AZ, ensure that you have an ELB node associated with AZ you want to route traffic to. Nodes used by ELB to distribute traffic to your target groups.

### SSL/TLS
- Allows traffic between ALB and clients to be encyrpted in transit.
- For HTTPS(allows for encrypted communication) as a listener
- Server Name Indication (SNI) allows you to expose multiple HTTPS applications each with its own SSL certificate on the same listener. Read more here: https://aws.amazon.com/blogs/aws/new-application-load-balancer-sni/
